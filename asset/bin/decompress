#! /usr/bin/env node

if (process.env.TEST_EXIT_CODE) {
    process.stderr.write('test failure');
    process.exit(process.env.TEST_EXIT_CODE);
}

const fs = require('fs');

const src = fs.createReadStream(process.argv[2]);
const dst = fs.createWriteStream(process.argv[3]);

// TODO: Assuming lz4 for now.  Either add option or try to auto-detect.
const decoder = require('lz4').createDecoderStream();

process.stdout.write(`decompressing ${process.argv[2]} to ${process.argv[3]}...`);
src.pipe(decoder).pipe(dst);
process.stdout.write(' finished.\n');
